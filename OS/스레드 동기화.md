# 스레드 동기화

## 1. 스레드 동기화란?

- 다수의 스레드가 동시 공유 데이터 접근 -> 공유 데이터 훼손
- **스레드 동기화**
    - 공유 데이터에 대한 다수의 스레드가 동시에 접근 할 때 데이터가 훼손되는 문제의 해결책
    - 다수의 스레드가 충돌 없이 공유 데이터제 접근하기 위해 상호 협력
    - **한 스레드가 공유 데이터에 대한 접근을 마칠 때 까지 다른 스레드가 접근하지 못하도록 제어**
    
## 2. 임계 영역과 상호배제

### 2-1. 임계 영역(Critical Section)

공유 변수 영역, 둘 이상의 스레드가 동시에 접근해서는 안되는 공유 자원    
어떤 스레드가 임계 구역에 들어가고자 하면 지정된 시간만큼 대기

### 2-2. 임계 영역 문제(Critical Section Problem)

임계 구역에 동시에 접근해서 생기는 잘못된 동작 등

#### 해결을 위한 뼈대
```
do {
    entry section        // 입장 구역
        critical section // 임계 구역
    exit section         // 퇴장 구역
        remainder section
} while (True)
```

### 2-3. 해결 방법

#### 해결을 위한 세가지 기본 조건
임계 영역에 대한 근본적 해결책 -> 공유 자원에 대한 동시접근 방지 -> **상호배제**  
하지만 상호 배제에만 집중하면 의도치 않게 프로세스가 실행되지 못하고 마냥 대기만 하는 기아상태(starvation) 에 빠질 수 있어 **진행, 한계 대기** 조건을 추가 해야함

1. 상호 배제 (Mutual exclusion)
   - 한 시점에 하나의 스레드(또는 프로세스)만이 임계 영역에 접근 할 수 있도록 함
   - 다른 스레드가 동시에 같은 자원을 변경할 수 없도록 보장
2. 진행 (Progress)
   - 임계 영역에 접근하고자 하는 스레드가 없거나, 임계 영역에서 실행을 마친 스레드가 다른 스레드의 진입을 무한히 지연시키지 않아야 함
3. 한정된 대기 (Bounded waiting)
   - 어떤 스레드도 다른 스레드에 의해 무한히 대기 상태로 남겨져서는 안 됨
   - 모든 스레드는 유한 시간 내에 임계 영역에 진입할 수 있어야 함
  
#### 소프트웨어적 해결 방법
프로그래머가 알고리즘을 통해 상호 배제를 구현하는 방식
1. 데커의 알고리즘(Decker's Algorithm)
   - 두 프로세스가 서로 번갈아 가며 임계 영역에 진입하도록 하는 알고리즘
   - 각 프로세스는 다른 프로세스의 상태 확인, 임계 영역 진입 차례 기다림
2. 피터슨의 알고리즘(Peterson's Algorithm)
   - 데커 알고리즘 개선 버전
   - 프로세스는 공유 변수를 이용해 상호 배제 달성
3. 베이커의 알고리즘(Bakery Algorithm)
   - 두 개 이상의 프로세스가 임계 영역에 접근하려고 할 때 사용
   - 번호표를 뽑는 방식으로 임계 영역의 접근 순서 결정
  
#### 하드웨어적 해결 방법
하드웨어 수준에서 지원되는 기능을 사용하여 임계영역 문제 해결
1. 인터럽트 금지(Disabling Interrupt)
   - 인터럽트를 금지함으로써, 현재 실행중인 코드가 완전히 수행될 때까지 다른 프로세스 개입 막음
   - 주로 단일 프로세서 시스템에서 사용
2. 테스트 앤 세트(Test and Set)
   - 원자적 연산을 지원하는 하드웨어 명령어 사용
   - 변수값을 테스트 하고 설정하는 동시에 수행함으로써 상호배제 구현
3. 컴페어 앤 스왑(Compare and Swap)
   - 테스트 앤 세트와 유사하나 변수의 현재 값이 예상 값과 일치할 경우에만 새 값 설정
   - 더 정교한 동기화 제어
  
#### 운영체제에 의한 방법
운영체제가 제공하는 동기화 기능 사용  
프로그래머에게 추상화된 인터페이스 제공하여 보다 쉽게 임계영역 문제 해결 가능
1. 세마포어(Semaphores)
2. 뮤텍스(Mutexes)
3. 모니터(Monitors)